<script lang="ts">
	import Skeleton from "svelte-skeleton/Skeleton.svelte";

	export let gameid: string;
	export let code: string;

	let justCopied = false;

	const url = () => {
		return `https://chesse.koeni.dev/play/${gameid}-${code}`;
	};

	function handleShareCopy() {
		navigator.clipboard.writeText(url());
		justCopied = true;
		setTimeout(() => (justCopied = false), 1500);
	}

	function handleShareWhatsApp() {
		const message = `Come play chess against me at ${url()}!`;
		const action = `https://wa.me/?text=${encodeURIComponent(message)}`;
		window.open(action, "_blank");
	}

	function handleShareTelegram() {
		const message = "Come play chess against me!";
		const action = `https://t.me/share/url?url=${encodeURIComponent(
			url()
		)}&text=${encodeURIComponent(message)}`;
		window.open(action, "_blank");
	}
</script>

<div>
	<p class="text-center text-base font-medium text-gray-500">Share This Game</p>
	{#if !gameid || !code}
		<Skeleton width={180} height={32} />
	{/if}
	{#if gameid && code}
		<div class="mt-2 flex items-center justify-center gap-2">
			<button on:click={handleShareCopy} class="button-secondary h-8 text-gray-700">
				{#if !justCopied}
					<svg
						class="fill-current"
						xmlns="http://www.w3.org/2000/svg"
						role="img"
						aria-labelledby="ariaCopyTitle"
						x="0px"
						y="0px"
						width="100%"
						height="100%"
						viewBox="0 0 24 24">
						<title id="ariaCopyTitle">Copy game link to clipboard</title>
						<path
							d="M 4 2 C 2.895 2 2 2.895 2 4 L 2 17 C 2 17.552 2.448 18 3 18 C 3.552 18 4 17.552 4 17 L 4 4 L 17 4 C 17.552 4 18 3.552 18 3 C 18 2.448 17.552 2 17 2 L 4 2 z M 8 6 C 6.895 6 6 6.895 6 8 L 6 20 C 6 21.105 6.895 22 8 22 L 20 22 C 21.105 22 22 21.105 22 20 L 22 8 C 22 6.895 21.105 6 20 6 L 8 6 z M 8 8 L 20 8 L 20 20 L 8 20 L 8 8 z" />
					</svg>
				{/if}
				{#if justCopied}
					<svg
						class="fill-current"
						xmlns="http://www.w3.org/2000/svg"
						role="img"
						aria-labelledby="ariaCopiedTitle"
						x="0px"
						y="0px"
						width="100%"
						height="100%"
						viewBox="0 0 24 24">
						<title id="ariaCopiedTitle">Game link copied to clipboard</title>
						<path
							d="M19,3h-4.184C14.403,1.837,13.304,1,12,1S9.597,1.837,9.184,3H5C3.895,3,3,3.895,3,5v14c0,1.105,0.895,2,2,2h14 c1.105,0,2-0.895,2-2V5C21,3.895,20.105,3,19,3z M8.707,11.293L11,13.586l4.293-4.293c0.39-0.39,1.024-0.39,1.414,0l0,0 c0.39,0.39,0.39,1.024,0,1.414l-5,5c-0.39,0.39-1.024,0.39-1.414,0l-3-3c-0.39-0.39-0.39-1.024,0-1.414l0,0 C7.683,10.902,8.316,10.902,8.707,11.293z M12,3c0.552,0,1,0.448,1,1c0,0.552-0.448,1-1,1s-1-0.448-1-1C11,3.448,11.448,3,12,3z" />
					</svg>
				{/if}
			</button>
			<button on:click={handleShareWhatsApp} class="button-secondary h-8 text-gray-700">
				<svg
					class="fill-current"
					xmlns="http://www.w3.org/2000/svg"
					role="img"
					aria-labelledby="ariaWhatsAppTitle"
					x="0px"
					y="0px"
					width="100%"
					height="100%"
					viewBox="0 0 24 24">
					<title id="ariaWhatsAppTitle">Share game link using WhatsApp</title>
					<path
						d="M19.077,4.928c-2.082-2.083-4.922-3.134-7.904-2.894C7.164,2.356,3.65,5.144,2.474,8.99 c-0.84,2.748-0.487,5.617,0.881,7.987L2.059,21.28c-0.124,0.413,0.253,0.802,0.67,0.691l4.504-1.207 c1.459,0.796,3.101,1.215,4.773,1.216h0.004c4.195,0,8.071-2.566,9.412-6.541C22.728,11.563,21.762,7.616,19.077,4.928z M16.898,15.554c-0.208,0.583-1.227,1.145-1.685,1.186c-0.458,0.042-0.887,0.207-2.995-0.624c-2.537-1-4.139-3.601-4.263-3.767 c-0.125-0.167-1.019-1.353-1.019-2.581S7.581,7.936,7.81,7.687c0.229-0.25,0.499-0.312,0.666-0.312c0.166,0,0.333,0,0.478,0.006 c0.178,0.007,0.375,0.016,0.562,0.431c0.222,0.494,0.707,1.728,0.769,1.853s0.104,0.271,0.021,0.437s-0.125,0.27-0.249,0.416 c-0.125,0.146-0.262,0.325-0.374,0.437c-0.125,0.124-0.255,0.26-0.11,0.509c0.146,0.25,0.646,1.067,1.388,1.728 c0.954,0.85,1.757,1.113,2.007,1.239c0.25,0.125,0.395,0.104,0.541-0.063c0.146-0.166,0.624-0.728,0.79-0.978 s0.333-0.208,0.562-0.125s1.456,0.687,1.705,0.812c0.25,0.125,0.416,0.187,0.478,0.291 C17.106,14.471,17.106,14.971,16.898,15.554z" />
				</svg></button>
			<button on:click={handleShareTelegram} class="button-secondary h-8 text-gray-700">
				<svg
					class="fill-current"
					xmlns="http://www.w3.org/2000/svg"
					role="img"
					aria-labelledby="ariaTelegramTitle"
					x="0px"
					y="0px"
					width="100%"
					height="100%"
					viewBox="0 0 24 24">
					<title id="ariaTelegramTitle">Share game link using Telegram</title>
					<path
						d="M 20.302734 2.984375 C 20.013769 2.996945 19.748583 3.080055 19.515625 3.171875 C 19.300407 3.256634 18.52754 3.5814726 17.296875 4.0976562 C 16.06621 4.61384 14.435476 5.2982348 12.697266 6.0292969 C 9.2208449 7.4914211 5.314238 9.1361259 3.3125 9.9785156 C 3.243759 10.007156 2.9645852 10.092621 2.65625 10.328125 C 2.3471996 10.564176 2.0039062 11.076462 2.0039062 11.636719 C 2.0039062 12.088671 2.2295201 12.548966 2.5019531 12.8125 C 2.7743861 13.076034 3.0504903 13.199244 3.28125 13.291016 C 3.9563403 13.559857 6.0424892 14.392968 6.9492188 14.755859 C 7.2668647 15.707799 8.0129251 17.950071 8.1875 18.501953 L 8.1855469 18.501953 C 8.3275588 18.951162 8.4659791 19.243913 8.6582031 19.488281 C 8.7543151 19.610465 8.8690398 19.721184 9.0097656 19.808594 C 9.0637596 19.842134 9.1235454 19.868148 9.1835938 19.892578 C 9.191962 19.896131 9.2005867 19.897012 9.2089844 19.900391 L 9.1855469 19.894531 C 9.2029579 19.901531 9.2185841 19.911859 9.2363281 19.917969 C 9.2652427 19.927926 9.2852873 19.927599 9.3242188 19.935547 C 9.4612233 19.977694 9.5979794 20.005859 9.7246094 20.005859 C 10.26822 20.005859 10.601562 19.710938 10.601562 19.710938 L 10.623047 19.695312 L 12.970703 17.708984 L 15.845703 20.367188 C 15.897113 20.439837 16.308174 20.998047 17.261719 20.998047 C 17.829844 20.998047 18.280978 20.718791 18.568359 20.423828 C 18.855741 20.128866 19.034757 19.82706 19.115234 19.417969 L 19.115234 19.414062 L 19.115234 19.412109 C 19.171124 19.121728 21.931641 5.265625 21.931641 5.265625 L 21.925781 5.2890625 C 22.01148 4.9067181 22.036735 4.5369631 21.935547 4.1601562 C 21.834358 3.7833495 21.561271 3.4156252 21.232422 3.2226562 C 20.903572 3.0296874 20.591699 2.9718046 20.302734 2.984375 z M 19.908203 5.1738281 C 19.799749 5.7182284 17.343164 18.059965 17.183594 18.878906 L 14.328125 16.240234 C 13.59209 15.559749 12.44438 15.535812 11.679688 16.181641 L 10.222656 17.414062 L 11 14.375 C 11 14.375 16.362547 8.9468594 16.685547 8.6308594 C 16.945547 8.3778594 17 8.2891719 17 8.2011719 C 17 8.0841719 16.939781 8 16.800781 8 C 16.675781 8 16.506016 8.1197812 16.416016 8.1757812 C 15.267511 8.8918132 10.350132 11.694224 7.96875 13.048828 C 7.8792978 12.995267 7.7913128 12.939666 7.6933594 12.900391 C 6.9119785 12.587666 5.4101276 11.985551 4.53125 11.634766 C 6.6055146 10.76177 10.161156 9.2658083 13.472656 7.8730469 C 15.210571 7.142109 16.840822 6.4570977 18.070312 5.9414062 C 19.108158 5.5060977 19.649538 5.2807035 19.908203 5.1738281 z M 17.152344 19.023438 C 17.152344 19.023438 17.154297 19.023438 17.154297 19.023438 C 17.154234 19.023761 17.152444 19.03095 17.152344 19.03125 C 17.154024 19.022709 17.151187 19.029588 17.152344 19.023438 z" />
				</svg>
			</button>
		</div>
	{/if}
</div>
